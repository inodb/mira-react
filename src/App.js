import React, { useRef, useState, useEffect } from "react";
import DataSelect from "./Select/DataSelect";
import Header from "@bit/viz.spectrum.header";
import Grid from "@material-ui/core/Grid";
import Content from "./ReDim/Content";

import { MuiThemeProvider } from "@material-ui/core/styles";
import { theme } from "./config/config.js";

import { withRouter } from "react-router";

const title = "scRNA Dashboard";
const description =
  "An interactive visualization for single cell RNA (scRNA) QC data, as generated by the scRNA-seq pipeline (https://github.com/shahcompbio/SCRNApipeline)";

const ContentStyles = {
  width: "70%",
  display: "flex",
  flexDirection: "row"
};

const App = ({ location }) => {
  const [patientID, sampleID] = location.pathname.substr(1).split("/");
  const [screenWidth, setWidth] = useState(0);
  const [screenHeight, setHeight] = useState(0);
  const [label, setLabel] = useState(null);

  const widthRef = useRef(0);
  const heightRef = useRef(0);

  const updateDimensions = () => {
    setWidth(widthRef.current.clientWidth);
    setHeight(heightRef.current.clientHeight);
  };

  window.addEventListener("resize", updateDimensions);

  useEffect(() => {
    updateDimensions();
  });

  return (
    <MuiThemeProvider theme={theme}>
      <Header name={title} description={description} />
      <Grid
        container
        direction="row"
        justify="flex-start"
        alignItems="flex-start"
        spacing={2}
        ref={widthRef}
        style={{
          flexWrap: "nowrap",
          whiteSpace: "nowrap",
          padding: "50px 0px"
        }}
      >
        <Grid item ref={heightRef}>
          <DataSelect
            patientID={patientID}
            sampleID={sampleID}
            updateLabel={label => setLabel(label)}
            label={label}
          />
        </Grid>
        <div style={ContentStyles}>
          <Content
            screenHeight={screenHeight}
            screenWidth={screenWidth}
            patientID={patientID}
            sampleID={sampleID}
            label={label}
            onClick={label => setLabel(label)}
          />
        </div>
      </Grid>
    </MuiThemeProvider>
  );
};

export default withRouter(App);
